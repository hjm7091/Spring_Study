## Spring이란 무엇인가?

### 1. 스프링의 정의

- 자바 엔터프라이즈 개발을 편하게 해주는 오픈소스 경량급 애플리케이션 프레임워크

#### 1) 애플리케이션 프레임워크
    - 애플리케이션 프레임워크는 특정 계층이나 기술, 업무 분야에 국한되지 않고 애플리케이션의 전 영역을
      포괄하는 범용적인 프레임워크를 말한다.

    - 스프링의 존재 목적은 핵심 기술에 담긴 프로그래밍 모델을 일관되게 적용해서 엔터프라이즈 애플리케이션
      전 계층과 전 영역에 전략과 기능을 제공해줌으로써 애플리케이션을 편리하게 개발하게 해주는 애플리케이션
      프레임워크로 사용하기 위해서임.
  
#### 2) 경량급
    - 스프링은 경량급(lightweight)이라는 말의 의미는 불필요하게 무겁지 않다는 의미이다.
      이는 스프링의 기원이 된 책에서 비판하는 자바 엔터프라이즈 기술의 불필요한 복잡함에 반대되는 개념이다.

    - 스프링은 EJB를 대표로 하는 기존의 많은 기술이 불필요하게 무겁고 복잡했음을 증명했고 그런 면에서 스프링은
      군더더기 없이 깔끔한 기술을 가진 '경량급' 프레임워크라고 불리게 된 것이다.

#### 3) 자바 엔터프라이즈 개발을 편하게
    - EJB 역시 개발자가 실수하기 쉬운 로우레벨 기술에 많은 신경을 쓰지 않으면서도 핵심 비즈니스
      로직을 쉽고 빠르게 구현할 수 있도록 하는 것을 목표로 하여 처음 등장했다.
    
    - EJB는 일정 부분에서는 엔터프라이즈 개발의 고민거리와 부담을 덜어주었지만 그 과정에서 다른 차원의
      더 큰 복잡함을 애플리케이션 개발에 끌고 들어오는 실수를 저질렀다.

    - 스프링은 EJB가 궁극적으로 이루고자 했던 이 목적을 제대로 실현하게 해주는 프레임워크다.

#### 4) 오픈소스
    - 오픈소스의 장점은 공개된 커뮤니티의 공간 안에서 투명한 방식으로 다양한 참여를 통해 개발되기 때문에
      매우 빠르고 유연한 개발이 가능하다. 오픈소스 제품의 사용자는 소스코드를 다운받아서 품질과 기능을 얼마든지 
      검증하고 분석해 볼 수 있다. 발견한 버그를 신고하거나 기능 개선을 제안했다면 그것이 어떻게 처리되는지도 
      지켜볼 수 있다.

    - 오픈소스 개발 방식의 가장 큰 취약점은 지속적이고 안정적인 개발이 계속될지가 불확실하다는 점이다. 어떤 때는 
      단순한 버그 하나가 수정되기까지 몇 년씩 걸리거나 개발자들이 다 떠나서 프로젝트 자체가 사장되는 최악의 상황까지
      갈 수 있다.

    - 스프링의 창시자인 로드 존슨을 비롯한 몇몇의 사람들은 오픈소스의 단점을 극복하고자 개발을 책임지고 진행할
      수 있도록 전문 기업인 스프링 소스를 만들었다. 스프링 소스는 2009년 세계적인 IT 기업인 VMWare에 합병되면서
      이전보다 더욱 안정된 환경과 조직의 지원을 통해 오픈소스 스프링의 개발에 더욱 전념할 수 있게 되었다.

* * *

### 2. 스프링의 목적

- 스프링의 목적은 스프링의 정의를 통해 살펴봤듯이 '경량급 프레임워크인 스프링을 활용해서 엔터프라이즈 애플리케이션 개발을 편하게' 하는 것이다.

#### 1) 엔터프라이즈 개발이 복잡한 이유
    - 기술적인 제약조건과 요구사항이 늘어나기 때문이다.
    
    - 엔터프라이즈 애플리케이션이 구현해야 할 핵심기능인 비즈니스 로직의 복잡함이 증가한다.
    
    - 가장 큰 이유는 근본적인 비즈니스 로직과 엔터프라이즈 기술이라는 두 가지 복잡함이 한데 얽혀 있기 때문이다.


#### 2) 복잡함을 해결하려는 도전
    - 엔터프라이즈 개발의 근본적인 복잡함의 원인은 제거할 대상이 아니다. 기술적인 복잡함을 해결하고자 보안을 취약하게
      만들 수는 없다.

    - 복잡함의 제거 대신에 복잡함을 효과적으로 상대할 수 있는 전략과 기법이 필요하다.

    - 비즈니스 로직의 복잡함을 다루는 것과 기술적인 복잡함을 다루는 것은 전혀 다르기 때문에 가장 먼저 할 일은
      이 두 가지 복잡함을 분리해내는 것이다.

#### 3) 실패한 해결책 : EJB
    - EJB는 일부 기술적인 복잡함을 덜어주려는 시도를 하다가 오히려 더 큰 복잡함을 추가하는 실수를 범했다.

    - EJB라는 틀 안에서 자바 코드를 만들게 강제함으로써 자바 언어가 원래 갖고 있던 장점마자 잃어버렸다.(상속 or 다형성) 

#### 4) 비침투적인 방식을 통한 효과적인 해결책 : 스프링
    - EJB처럼 어떤 기술을 적용했을 때 그 기술과 관련된 코드나 규약 등이 코드에 등장하는 경우를 침투적인 기술이라고 한다.

    - 비침투적인 기술은 기술의 적용 사실이 코드에 직접 반영되지 않는다는 특징이 있다. 스프링이 성공할 수 있었던 이유는 
      바로 비침투적인 기술이라는 전략을 사용했기 때문이다.

    - 스프링을 이용하면 기술적인 복잡함과 비즈니스 로직을 다루는 코드를 깔끔하게 분리할 수 있다. 스프링은 꼭 필요할 것 
      같은 경우조차도 기술 코드가 직접 노출되지 않도록 만들어줬다.

#### 5) 복잡함을 상대하는 스프링의 전략

(1) 기술적 복잡함을 상대하는 전략

    1) 첫 번째 문제 : 기술에 대한 접근 방식이 일관성이 없고 특정 환경에 종속적이다.
    
    -> 해결 방법 : 서비스 추상화, 템플릿 콜백 패턴 사용
    
    2) 두 번째 문제 : 기술적인 처리를 담당하는 코드가 성격이 다른 코드에 섞여서 등장한다.

    -> 해결 방법 : AOP 사용

(2) 비즈니스와 애플리케이션 로직의 복잡함을 상대하는 전략

    - 비즈니스 로직의 복잡함을 상대하는 전략은 자바라는 객체지향 기술 그 자체다.

    - 스프링은 단지 객체지향 언어의 장점을 제대로 살리지 못하게 방해했던 요소를 제거하도록 도와줄 뿐이다.

(3) 핵심 도구 : 객체지향과 DI

    - 기술적인 복잡함을 효과적으로 다루게 해주는 기법은 모두 DI를 바탕으로 하고 있다. 서비스 추상화, 템플릿/콜백, AOP
      와 같은 스프링의 기술은 DI없이는 존재할 수 없다.

    - DI란 특별한 기술이라기보다는 유연하게 확장할 수 있는 오브젝트 설계를 하다 보면 자연스럽게 적용하게 되는 객체지향
      프로그래밍 기법일 뿐이다.

    - 결국 모든 스프링의 기술과 전략은 객체지향이라는 자바 언어가 가진 강력한 도구를 극대화해서 사용할 수 있도록 돕는 
      것이라고 볼 수 있다.

* * *

### 3. POJO 프로그래밍

- 스프링 핵심 개발자들은 "스프링의 정수는 엔터프라이즈 서비스 기능을 POJO 에서 제공하는 것"이라고 했다.
  
- 엔터프라이즈 서비스 기술을 POJO 방식으로 개발된 애플리케이션 핵심 로직을 담은 코드에 제공하는 것이 스프링의 가장 강력한 특징과 목표다.

#### 1) 스프링의 핵심 : POJO

    - 스프링의 주요 기술인 IoC/DI, AOP와 PSA(Portable Service Abstraction)는 애플리케이션을 POJO로
      개발할 수 있게 해주는 가능기술이라고 불린다.

#### 2) POJO란 무엇인가?

    - POJO는 Plain Old Java Object의 첫 글자를 따서 만든 약자다.

    - 이 단어는 마틴 파울러가 처음 쓰기 시작했는데 단순히 간단한 자바 오브젝트를 사용하는 것을 뭔가 있어보이도록 
      만든 이름일 뿐 특별한 기술을 가리키는 용어는 아니다.

#### 3) POJO의 조건

- 단지 자바의 문법을 지키고, 순수하게 JavaSE API만을 사용했다고 해서 그 코드를 POJO라고 할 수는 없다.
  
- 진정한 POJO란 객체지향적인 원리에 충실하면서, 환경과 기술에 종속되지 않고 필요에 따라 재활용될 수 있는 방식으로 설계된 오브젝트를 말한다.

(1) 특정 규약에 종속되지 않는다.

    - POJO는 자바 언어와 꼭 필요한 API 외에는 종속되지 않아야 한다.

    - 별다른 가치를 주지도 못하는 규약 따위에 종속되지 않아야 하고, 객체지향 설계의 자유로운 적용이 가능한
      오브젝트여야만 POJO라고 불릴 수 있다.

(2) 특정 환경에 종속되지 않는다.

    - EJB는 JNDI 서버 서비스가 반드시 필요하다. 이처럼 JNDI와 같은 특정 환경이 의존 대상 검색 방식에 종속적
      이라면 POJO라 할 수 없다.

    - 애플리케이션 로직을 담고 있는 오브젝트 코드가 특정 환경에 종속되게 만드는 경우라면 그것 역시 POJO라고 할 수 없다.

#### 4) POJO의 장점

    - POJO가 될 수 있는 조건이 그대로 POJO의 장점이다.

    - POJO로 개발된 코드는 자동화된 테스트에 매우 유리하다.

    - 객체지향적인 설계를 자유롭게 적용할 수 있다는 것도 큰 장점이다.

#### 5) POJO 프레임워크

    - 스프링 프레임워크와 하이버네이트를 대표적인 POJO 프레임워크로 꼽을 수 있다.

    - 좋은 코드와 좋은 프레임워크의 특징은 그것을 사용해서 만들어지는 코드가 나쁜 코드가 되기 어렵다는 점이다.

    - 스프링은 자연스럽게 개발자가 좋은 코드를 만들게 해주는 특징이 있다.

* * *

### 4. 스프링의 기술

- 스프링에는 POJO 프로그래밍을 손쉽게 할 수 있도록 지원하는 세 가지 가능 기술(enabling technology)을 제공한다.

- 그 세 가지 기술은 IoC/DI, AOP, PSA이다.

#### 1) 제어의 역전(IoC) / 의존관계 주입(DI)

(1) 핵심 기능의 변경

- DI의 가장 대표적인 적용 방법은 바로 의존 대상의 구현을 바꾸는 것이다.

(2) 핵심 기능의 동적인 변경

- 일반적인 DI를 이용한 변경 방법과는 달리, 동적으로 매번 다르게 변경 할 수 있다.

(3) 부가기능의 추가

- DI의 세 번째 활용 방법은 핵심기능은 그대로 둔 채로 부가기능을 추가하는 것이다. 
  
- 데코레이터 패턴을 생각해보면 된다. 
  
- 인터페이스를 두고 사용하게 하고, 실제 사용할 오브젝트는 외부에서 주입하는 DI를 적용해두면 데코레이터 패턴을 쉽게 적용할 수 있다.

(4) 인터페이스의 변경

- 클라이언트가 사용하는 인터페이스와 실제 오브젝트 사이에 인터페이스가 일치하지 않는 경우에도 DI가 유용하다.

- 디자인 패턴에서 말하는 오브젝트 방식의 어댑터 패턴의 응용이라고 볼 수 있다.

- PSA는 클라이언트가 일관성 있게 사용할 수 있는 인터페이스를 정의해주고 DI를 통해 어댑터 역할을 하는 오브젝트를 이용하게 해준다.

(5) 프록시

- 필요한 시점에 실제 사용할 오브젝트를 초기화하고 리소스를 준비하게 해주는 지연된 로딩(lazy loading)을 적용하려면 프록시가 필요하다.

- 원격 오브젝트를 호출할 때 마치 로컬에 존재하는 오브젝트처럼 사용할 수 있게 해주는 원격 프록시를 적용하려면 프록시가 필요하다.

- 위 두 가지 방법 모두 DI를 필요로 한다.

(6) 템플릿과 콜백

- 템플릿/콜백 패턴은 DI의 특별한 적용 방법이다.

- 반복적으로 등장하지만 항상 고정적인 작업 흐름과 그 사이에서 자주 바뀌는 부분을 분리해서 템플릿과 콜백으로 만들고 이를 DI 원리를 응용해 적용하면
  지저분하게 매번 만들어야 하는 코드를 간결하게 만들 수 있다.
  
- 콜백을 템플릿에 주입하는 방식으로 동작하게 하는 것은 DI 원리에 가장 충실한 응용 방법이다.

(7) 싱글톤과 오브젝트 스코프

- DI가 필요한 이유 중 한 가지는 DI 할 오브젝트의 생명주기를 제어할 수 있다는 것이다.

- DI를 프레임워크로 이용한다는 건 DI 대상 오브젝트를 컨테이너가 관리한다는 의미다. 

- 스프링에서는 기본 스코프인 싱글톤과 싱글톤 외에도 다양한 스코프를 갖는 오브젝트를 만들어 DI에 사용할 수도 있다.

- 오브젝트 스코프를 제어하는 방법 또한 DI를 적용했기 때문에 가능한 활용 방법이다.

(8) 테스트

- 테스트를 할 때는 의존 오브젝트를 대신해서 스텁 또는 목 오브젝트 같은 테스트 대역을 활용해야 한다.

- DI를 위해 만든 수정자 메소드를 사용하면 테스트 코드 안에서 수동으로 목 오브젝트를 주입할 수 있다.
  또는 테스트용으로 설정을 별도로 만드는 방법도 있다.

- DI 없이는 이런 테스트 기법을 적용하기란 불가능하다.

#### 2) 애스펙트 지향 프로그래밍(AOP)

- IoC/DI를 이용해서 POJO만으로 엔터프라이즈 서비스를 제공할 수 있지만 일부 서비스는 순수한 객체지향 기법만으로는 
  POJO의 조건을 유지한 채로 적용하기 힘들다. 

- 바로 이런 문제를 해결하기 위해 AOP가 필요하다. 스프링의 AOP는 스프링이 POJO 프로그래밍을 지원하려는 그 핵심
  목적을 위해 중요한 역할을 하고 있다.

AOP의 적용 기법

(1) 첫 번째는 스프링과 같이 다이내믹 프록시를 사용하는 방법이다.

    - 이 방법은 기존 코드에 영향을 주지 않고 부가기능을 적용하게 해주는 데코레이터 패턴을 용용한 것이다.

    - 부가기능을 부여할 수 있는 곳은 메소드의 호출이 일어나는 지점뿐이라는 제약이 있다.

    - 스프링의 기본적인 AOP 구현 방법은 다이내믹 프록시를 이용하는 프록시 AOP 방식이다.

    - 엔터프라이즈 개발에서 필요로 하는 AOP는 대부분이 이 프록시 방식의 AOP면 된다.

(2) 두 번째는 자바 언어의 한계를 넘어서는 언어의 확장을 이용하는 방법이다.

    - AspectJ라는 유명한 오픈소스 AOP 툴이 있다. 이 AspectJ는 강력한 고급 기능을 가진 AOP를 제공한다.

    - 메소드 호출뿐 아니라 인스턴스 생성, 필드 액세스, 특정 호출 경로를 가진 메소드 호출 등에도 부가기능을
      제공할 수 있다.

    - 스프링은 프록시 방식의 AOP를 기본으로 하고 있지만, 원한다면 AspectJ를 이용한 AOP로 바꿔서 사용할 수 있다.

AOP의 적용 단계

(1) AOP 적용 1단계 : 미리 준비된 AOP 이용

    - 일단 처음에는 스프링이 미리 만들어서 제공하는 AOP 기능을 그대로 가져다 적용하는 것으로 시작한다.

    - 스프링이 직접 제공해주는 대표적인 AOP에는 트랜잭션이 있다.

    - AspectJ를 이용한 @Configurable 애노테이션을 이용해서 도메인 오브젝트에 DI를 자동 적용해주는
      것도 스프링이 직접 제공해주는 AOP이다.

    - 두 가지 모두 간단한 설정을 추가하는 것만으로도 쉽게 적용되기 때문에 AOP에 대한 지식이나 경험이
      많지 않더라도 간단히 이용 가능하다는 장점이 있다.

(2) AOP 적용 2단계 : 전담팀을 통한 정책 AOP 적용

    - 애플리케이션 전체적으로 이용 가능한 것을 소수의 AOP 담당자 관리하에 적용해 볼 수 있다.

    - 대표적으로 비즈니스 로직을 가진 오브젝트에 대한 보안, 특정 계층의 오브젝트 이용 전후의 작업 기록을
      남기는 로깅, 데이터 추적을 위한 트레이싱, 특정 구간의 실시간 성능 모니터링과 같은 정책적으로 적용할
      만한 기능에 AOP를 이용하는 것을 들 수 있다.

(3) AOP 적용 3단계 : AOP의 자유로운 이용

    - 첫 번째와 두 번째 단계를 거쳐서 AOP에 어느 정도 친숙해지고, 그 장단점과 응용 전략, 위험성 등을 어느 정도
      이해했다면 이제는 개발자 스스로가 AOP를 활용할 수 있는 단계로 넘어갈 수 있다.

    - 물론 다른 팀이나 개발자가 만든 코드에 몰래 적용되는 AOP 기능은 만들어선 안 된다.

#### 3) 포터블 서비스 추상화(PSA)

- 세 번째 가능기술은 환경과 세부 기술의 변화에 관계없이 일관된 방식으로 기술에 접근 할 수 있게 해주는 PSA
  (Portable Service Abstraction)이다.

- 서비스 추상화를 위해 필요한 기술은 DI뿐이다. 결국 DI 응용 방법의 한 가지이므로 DI를 적극 활용해서 개발한다면
  서비스 추상화는 자연스럽게 만들어 쓸 수 있다.
  
* * *

### 5. 요약

- 엔터프라이즈 애플리케이션 개발의 복잡함은 비즈니스 로직과 엔터프라이즈 시스템의 기술적인 요구에 의해 발생한다.
  기존의 접근 방법(ex : EJB)은 이 복잡도를 낮추지 못하며 자바의 객체지향적인 장점을 포기해야 한다는 문제점이 있다.
  
- 스프링을 사용하면 자바의 근본인 객체지향적인 원리에 충실하게 개발할 수 있으며, 환경과 규약에 의존적이지 않은
  POJO를 이용한 애플리케이션 개발은 엔터프라이즈 시스템 개발의 복잡함이 주는 많은 문제를 해결할 수 있다.
  
- POJO 개발 방식의 개발을 돕기 위해 스프링은 IoC/DI, AOP, PSA와 같은 가능기술을 프레임워크와 컨테이너라는 방식을
  통해 제공한다.

